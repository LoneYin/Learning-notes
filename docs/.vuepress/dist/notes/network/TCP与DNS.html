<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP协议与DNS协议 | 学习笔记</title>
    <meta name="description" content="构建自己的前端知识体系">
    
    
    <link rel="preload" href="/assets/css/0.styles.a4aa4dff.css" as="style"><link rel="preload" href="/assets/js/app.d90b1a7d.js" as="script"><link rel="preload" href="/assets/js/2.ddf9653e.js" as="script"><link rel="preload" href="/assets/js/35.f0f27945.js" as="script"><link rel="prefetch" href="/assets/js/10.2822c8d4.js"><link rel="prefetch" href="/assets/js/11.953eb217.js"><link rel="prefetch" href="/assets/js/12.08cd3bc9.js"><link rel="prefetch" href="/assets/js/13.3ea07363.js"><link rel="prefetch" href="/assets/js/14.08d3c49e.js"><link rel="prefetch" href="/assets/js/15.99b05918.js"><link rel="prefetch" href="/assets/js/16.9b87fae1.js"><link rel="prefetch" href="/assets/js/17.e263599c.js"><link rel="prefetch" href="/assets/js/18.a9e58c70.js"><link rel="prefetch" href="/assets/js/19.450252cb.js"><link rel="prefetch" href="/assets/js/20.67219f9a.js"><link rel="prefetch" href="/assets/js/21.83fb62ce.js"><link rel="prefetch" href="/assets/js/22.454161a4.js"><link rel="prefetch" href="/assets/js/23.cd0dc78c.js"><link rel="prefetch" href="/assets/js/24.62650fe5.js"><link rel="prefetch" href="/assets/js/25.5fa89824.js"><link rel="prefetch" href="/assets/js/26.69c19d16.js"><link rel="prefetch" href="/assets/js/27.014678fc.js"><link rel="prefetch" href="/assets/js/28.f12de4e4.js"><link rel="prefetch" href="/assets/js/29.7699ebd7.js"><link rel="prefetch" href="/assets/js/3.b0a6775b.js"><link rel="prefetch" href="/assets/js/30.9261d85c.js"><link rel="prefetch" href="/assets/js/31.57536ebb.js"><link rel="prefetch" href="/assets/js/32.a73b6dce.js"><link rel="prefetch" href="/assets/js/33.36884a86.js"><link rel="prefetch" href="/assets/js/34.79921d3e.js"><link rel="prefetch" href="/assets/js/36.2a08bebc.js"><link rel="prefetch" href="/assets/js/37.294494f7.js"><link rel="prefetch" href="/assets/js/38.20d8a33d.js"><link rel="prefetch" href="/assets/js/39.5bc82999.js"><link rel="prefetch" href="/assets/js/4.554dccb8.js"><link rel="prefetch" href="/assets/js/40.b64c9fda.js"><link rel="prefetch" href="/assets/js/41.ca3e1133.js"><link rel="prefetch" href="/assets/js/42.34bdf90e.js"><link rel="prefetch" href="/assets/js/5.7ec69b64.js"><link rel="prefetch" href="/assets/js/6.9a961699.js"><link rel="prefetch" href="/assets/js/7.7e6eebce.js"><link rel="prefetch" href="/assets/js/8.4a1300d9.js"><link rel="prefetch" href="/assets/js/9.5d664d52.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a4aa4dff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">前端笔记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">前端笔记</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/browser/浏览器的进程与线程.html" class="sidebar-link">浏览器的进程与线程</a></li><li><a href="/notes/browser/浏览器的渲染原理.html" class="sidebar-link">浏览器的渲染原理</a></li><li><a href="/notes/browser/浏览器JS引擎.html" class="sidebar-link">浏览器JS引擎（V8）</a></li><li><a href="/notes/browser/浏览器EventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/notes/browser/浏览器缓存策略.html" class="sidebar-link">浏览器缓存策略</a></li><li><a href="/notes/browser/跨域与页面通信.html" class="sidebar-link">跨域与页面通信</a></li><li><a href="/notes/browser/浏览器DOM事件与事件监听.html" class="sidebar-link">浏览器DOM事件与事件监听</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>网络知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/network/TCP与DNS.html" class="active sidebar-link">TCP协议与DNS协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/network/TCP与DNS.html#网络分层" class="sidebar-link">网络分层</a></li><li class="sidebar-sub-header"><a href="/notes/network/TCP与DNS.html#tcp" class="sidebar-link">TCP</a></li><li class="sidebar-sub-header"><a href="/notes/network/TCP与DNS.html#dns" class="sidebar-link">DNS</a></li></ul></li><li><a href="/notes/network/HTTP协议.html" class="sidebar-link">HTTP/HTTPS/HTTP2</a></li><li><a href="/notes/network/GET和POST请求的区别.html" class="sidebar-link">GET请求和POST请求的区别</a></li><li><a href="/notes/network/Web安全.html" class="sidebar-link">Web安全 —— XSS 与 CSRF</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/advanced/JS执行上下文栈.html" class="sidebar-link">JS执行上下文栈</a></li><li><a href="/notes/advanced/原型链与继承.html" class="sidebar-link">原型链继承</a></li><li><a href="/notes/advanced/Iterator和Generator.html" class="sidebar-link">Iterator和Generator</a></li><li><a href="/notes/advanced/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/notes/advanced/Proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/notes/advanced/节流和防抖.html" class="sidebar-link">函数的节流和防抖</a></li><li><a href="/notes/advanced/函数柯里化.html" class="sidebar-link">函数柯里化和偏函数</a></li><li><a href="/notes/advanced/bind和call和apply.html" class="sidebar-link">手写 bind/call/apply</a></li><li><a href="/notes/advanced/另一个角度理解this.html" class="sidebar-link">从另一个角度理解this</a></li><li><a href="/notes/advanced/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/notes/advanced/常见算法.html" class="sidebar-link">常见算法</a></li><li><a href="/notes/advanced/单例模式.html" class="sidebar-link">JavaScript 中单例设计模式的应用</a></li><li><a href="/notes/advanced/观察者模式.html" class="sidebar-link">观察者模式的简单实现</a></li><li><a href="/notes/advanced/使用setTimeout模拟setInterval.html" class="sidebar-link">用 setTimeout 实现 setInterval</a></li><li><a href="/notes/advanced/new运算符.html" class="sidebar-link">new运算符到底做了什么</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/others/模块加载机制.html" class="sidebar-link">模块加载机制</a></li><li><a href="/notes/others/前端性能优化.html" class="sidebar-link">前端性能优化</a></li><li><a href="/notes/others/移动端适配方案.html" class="sidebar-link">移动端适配方案</a></li><li><a href="/notes/others/Vue与React的区别.html" class="sidebar-link">Vue与React的区别</a></li><li><a href="/notes/others/面试题整理.html" class="sidebar-link">一些JS面试题整理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>个人随笔</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/essay/给ReactRouter添加转场动画.html" class="sidebar-link">给React-Router添加路由页面切换时的过渡动画</a></li><li><a href="/notes/essay/Vue列表渲染中的key的作用.html" class="sidebar-link">key在Vue渲染列表时究竟起到了什么作用</a></li><li><a href="/notes/essay/vue源码阅读知识点整理.html" class="sidebar-link">Vue 源码阅读知识点整理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp协议与dns协议"><a href="#tcp协议与dns协议" class="header-anchor">#</a> TCP协议与DNS协议</h1> <h2 id="网络分层"><a href="#网络分层" class="header-anchor">#</a> 网络分层</h2> <ul><li>物理层</li> <li>数据链路层 (以太网)</li> <li>网络层（IP）</li> <li>传输层（TCP UDP)</li> <li>（TLS/SSL 在这里，属于会话层和表示层）</li> <li>应用层（HTTP, DNS, FTP, SMTP(邮件)）</li></ul> <h2 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h2> <h3 id="tcp-协议的特点"><a href="#tcp-协议的特点" class="header-anchor">#</a> TCP 协议的特点</h3> <ol><li><p>面向连接</p> <p>面向连接，是指发送数据之前必须在两端建立连接。建立连接的方法是“三次握手”，这样能建立可靠的连接。建立连接，是为数据的可靠传输打下了基础。</p></li> <li><p>仅支持单播传输</p> <p>每条 TCP 传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播传输方式。</p></li> <li><p>面向字节流</p> <p>TCP 不像 UDP 一样那样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输。</p></li> <li><p>可靠传输</p> <p>对于可靠传输，判断丢包，误码靠的是 TCP 的段编号以及确认号。TCP 为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。</p></li> <li><p>提供拥塞控制</p> <p>当网络出现拥塞的时候，TCP 能够减小向网络注入数据的速率和数量，缓解拥塞</p></li> <li><p>TCP 提供全双工通信</p> <p>TCP 允许通信双方的应用程序在任何时候都能发送数据，因为 TCP 连接的两端都设有缓存，用来临时存放双向通信的数据。当然，TCP 可以立即发送一个数据段，也可以缓存一段时间以便一次发送更多的数据段（最大的数据段大小取决于 MSS）</p></li></ol> <h3 id="tcp-三次握手"><a href="#tcp-三次握手" class="header-anchor">#</a> TCP 三次握手</h3> <blockquote><p>客户端：我想和你建立连接。</p></blockquote> <blockquote><p>服务端：ok，我现在可以和你建立连接。</p></blockquote> <blockquote><p>客户端：好的，那我们现在开始连接吧。</p></blockquote> <ul><li><p>第一次握手：客户端发送一个 TCP 标志位 SYN=1，ACK=0 的数据包给服务端，并随机会产生一个 Sequence number=3233.当服务端接收到这个数据后，服务端由 SYN=1 可知客户端是想要建立连接；</p></li> <li><p>第二次握手：服务端要对客户端的联机请求进行确认，向客户端发送应答号 ACK=1、SYN=1
确认号 Acknowledge number=3234，此值是客户端的序列号加 1，还会产生一个随机的序列号 Sequence number=36457，这样就告诉客户端可以进行连接；</p></li> <li><p>第三次握手：客户端收到数据后检查 Acknowledge number 是否是 3233+1 的值，以及 ACK 的值是否为 1，若为 1，host1 会发送 ACK=1、确认号码 Acknowledge number=36457，告诉服务端,你的请求连接被确认，连接可以建立。</p></li></ul> <h3 id="tcp-四次挥手"><a href="#tcp-四次挥手" class="header-anchor">#</a> TCP 四次挥手</h3> <blockquote><p>客户端：我准备断开连接了。</p></blockquote> <blockquote><p>服务端：ok，但是我这边可能还有一些数据要传，等我传我我会通知你。</p></blockquote> <blockquote><p>服务端：我传完了，可以断开连接了。</p></blockquote> <blockquote><p>客户端：ok，你断开连接吧。</p></blockquote> <blockquote><p>服务端：收到客户端最后一次信息后断开连接，未收到就会要求客户端重新发送关闭信息；
客户端：发送最后一次信息后等待 2MLS(2 倍报文最大生存时间)，没有收到服务端的重传请求就关闭自己的连接</p></blockquote> <ul><li><p>第一次挥手：当传输的数据到达尾部时，客户端向服务端发送 FIN=1 标志位；可理解成，客户端向服务端说，我这边的数据传送完成了，我准备断开了连接；</p></li> <li><p>第二次挥手：因 TCP 的连接是全双工的双向连接，关闭也是要从两边关闭；当服务端收到客户端发来的 FIN=1 的标志位后，服务端不会立刻向客户端发送 FIND=1 的请求关闭信息，
而是先向客户端发送一个 ACK=1 的应答信息，表示：你请求关闭的请求我已经收到，但我可能还有数据没有完成传送，你再等下，等我数据传输完成了我就告诉你；</p></li> <li><p>第三次挥手：服务端数据传输完成，向客户端发送 FIN=1，客户端收到请求关闭连接的请求后，客户端就明白服务端的数据已传输完成，现在可以断开连接了，</p></li> <li><p>第四次挥手：客户端收到 FIND=1 后，客户端还是怕由于网络不稳定的原因，怕服务端不知道他要断开连接，于是向服务端发送 ACK=1 确认信息进行确认，
把自己设置成 TIME_WAIT 状态并启动定时器，如果服务端没有收到 ACK，服务端 TCP 的定时器到达后，会要求客户端重新发送 ACK，当服务端收到 ACK 后，服务端就断开连接；
当客户端等待 2MLS（2 倍报文最大生存时间）后，没有收到服务端的重传请求后，他就知道服务端已收到了 ACK，所以客户端此时才关闭自己的连接。</p></li></ul> <h2 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h2> <p>DNS (Domain Name System)， 也叫网域名称系统，是互联网的一项服务。它实质上是一个 域名 和 IP 相互映射的分布式数据库，有了它，我们就可以通过域名更方便的访问互联网。</p> <p>DNS服务 使用 UDP 协议发送查询请求。</p> <h3 id="域名级别"><a href="#域名级别" class="header-anchor">#</a> 域名级别</h3> <p>域名级别是网址分类的一个标准，包括顶级域名、二级域名等。一个完整的域名由二个或二个以上部分组成，各部分之间用英文的句号<code>.</code>来分隔，倒数第一个<code>.</code>的右边部分称为顶级域名（TLD，也称为一级域名，包含一个合法字符串，和一个域名后缀），顶级域名的左边部分字符串到下个<code>.</code>为止称为二级域名（SLD），二级域名的左边部分称为三级域名，以此类推，每一级的域名控制它下一级域名的分配。所有域名后面其实都有一个隐藏的<code>.</code>，代表根域名。</p> <p>拿 <code>www.baidu.com</code> 来说  顶级域名com 二级域名baidu 三级域名www</p> <h3 id="dns解析流程"><a href="#dns解析流程" class="header-anchor">#</a> DNS解析流程</h3> <p>默认是先查找hosts文件，如果没有匹配到，再进行DNS解析</p> <ol><li>客户端向本地DNS服务器(递归解析服务器) 发出解析 <code>www.baidu.com</code> 域名的请求</li> <li>本地DNS服务器查看缓存，是否有缓存过 <code>www.baidu.com</code> 域名，如果有直接返回给客户端，如果没有执行下一步</li> <li>本地DNS服务器向根域名服务器发送请求，查询 com 顶级域的 nameserver 地址</li> <li>拿到com域名的IP后，再向 com nameserver 发送请求，获取 baidu 域名的nameserver 地址</li> <li>继续请求 baidu 的 nameserver, 获取 www 域名的地址，最终得到了 <code>www.baidu.com</code> 的IP，本地DNS服务器把这个结果缓存起来，以供下次查询快速返回</li> <li>本地DNS服务器把把结果返回给客户端</li></ol> <h3 id="递归服务器-与-权威域名服务器"><a href="#递归服务器-与-权威域名服务器" class="header-anchor">#</a> 递归服务器 与 权威域名服务器</h3> <p>我们在解析流程中发现两类DNS服务器，客户端直接访问的是 递归解析服务器， 它在整个解析过程中也最忙。 它的查询步骤是递归的，从根域名服务器开始，一直询问到目标域名。</p> <p>递归解析服务器通过请求一级一级的权威域名服务器，获得下一目标的地址，直到找到目标域名的 权威域名服务器</p> <p>简单来说： 递归解析服务器 是负责解析域名的， 权威域名服务器 是负责存储域名记录的</p> <p>递归服务器一般由互联网服务提供商提供（电信移动联通）</p> <h3 id="分级缓存"><a href="#分级缓存" class="header-anchor">#</a> 分级缓存</h3> <p>由于整个解析过程非常复杂，所以DNS 通过缓存技术来实现服务的鲁棒性。 当递归nameserver解析过 <code>www.baidu.com</code> 域名后，再次收到 <code>www.baidu.com</code> 查询时，它不会再走一遍递归解析流程，而是把上一次解析结果的缓存直接返回。 并且它是分级缓存的，也就是说，当下次收到的是 <code>www.baidu.com</code> 的查询时， 由于这台递归解析服务器已经知道 <code>baidu.com</code> 的权威 nameserver, 所以它只需要再向 <code>baidu.com</code> nameserver 发送一个查询www的请求就可以了。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/browser/浏览器DOM事件与事件监听.html" class="prev">浏览器DOM事件与事件监听</a></span> <span class="next"><a href="/notes/network/HTTP协议.html">HTTP/HTTPS/HTTP2</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d90b1a7d.js" defer></script><script src="/assets/js/2.ddf9653e.js" defer></script><script src="/assets/js/35.f0f27945.js" defer></script>
  </body>
</html>
