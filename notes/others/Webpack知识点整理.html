<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack 知识点整理 | 学习笔记</title>
    <meta name="description" content="构建自己的前端知识体系">
    
    
    <link rel="preload" href="/Learning-notes/assets/css/0.styles.20926f7d.css" as="style"><link rel="preload" href="/Learning-notes/assets/js/app.d658b911.js" as="script"><link rel="preload" href="/Learning-notes/assets/js/2.ddf9653e.js" as="script"><link rel="preload" href="/Learning-notes/assets/js/40.f8dca0d5.js" as="script"><link rel="prefetch" href="/Learning-notes/assets/js/10.c3a0c23e.js"><link rel="prefetch" href="/Learning-notes/assets/js/11.e1bb4b5e.js"><link rel="prefetch" href="/Learning-notes/assets/js/12.e83047c4.js"><link rel="prefetch" href="/Learning-notes/assets/js/13.5a89091d.js"><link rel="prefetch" href="/Learning-notes/assets/js/14.f754104c.js"><link rel="prefetch" href="/Learning-notes/assets/js/15.e86adc7e.js"><link rel="prefetch" href="/Learning-notes/assets/js/16.be0a4e09.js"><link rel="prefetch" href="/Learning-notes/assets/js/17.5b248867.js"><link rel="prefetch" href="/Learning-notes/assets/js/18.2b9b8a55.js"><link rel="prefetch" href="/Learning-notes/assets/js/19.085577f7.js"><link rel="prefetch" href="/Learning-notes/assets/js/20.a1f504d3.js"><link rel="prefetch" href="/Learning-notes/assets/js/21.c63eeff7.js"><link rel="prefetch" href="/Learning-notes/assets/js/22.7f6c815e.js"><link rel="prefetch" href="/Learning-notes/assets/js/23.28dc79e8.js"><link rel="prefetch" href="/Learning-notes/assets/js/24.fd6038b1.js"><link rel="prefetch" href="/Learning-notes/assets/js/25.65f35670.js"><link rel="prefetch" href="/Learning-notes/assets/js/26.3f895703.js"><link rel="prefetch" href="/Learning-notes/assets/js/27.648313b4.js"><link rel="prefetch" href="/Learning-notes/assets/js/28.5cae90b8.js"><link rel="prefetch" href="/Learning-notes/assets/js/29.9b1b8f04.js"><link rel="prefetch" href="/Learning-notes/assets/js/3.9113ff3d.js"><link rel="prefetch" href="/Learning-notes/assets/js/30.94410a61.js"><link rel="prefetch" href="/Learning-notes/assets/js/31.7043d084.js"><link rel="prefetch" href="/Learning-notes/assets/js/32.ee516927.js"><link rel="prefetch" href="/Learning-notes/assets/js/33.94246ef4.js"><link rel="prefetch" href="/Learning-notes/assets/js/34.6926d321.js"><link rel="prefetch" href="/Learning-notes/assets/js/35.38cc7b7c.js"><link rel="prefetch" href="/Learning-notes/assets/js/36.552bfea3.js"><link rel="prefetch" href="/Learning-notes/assets/js/37.a3640cca.js"><link rel="prefetch" href="/Learning-notes/assets/js/38.f20ad69f.js"><link rel="prefetch" href="/Learning-notes/assets/js/39.0efc5378.js"><link rel="prefetch" href="/Learning-notes/assets/js/4.554dccb8.js"><link rel="prefetch" href="/Learning-notes/assets/js/41.0689f648.js"><link rel="prefetch" href="/Learning-notes/assets/js/42.e17a356b.js"><link rel="prefetch" href="/Learning-notes/assets/js/43.241cdf11.js"><link rel="prefetch" href="/Learning-notes/assets/js/44.e8a08681.js"><link rel="prefetch" href="/Learning-notes/assets/js/45.0b1691fa.js"><link rel="prefetch" href="/Learning-notes/assets/js/5.7e2a17f1.js"><link rel="prefetch" href="/Learning-notes/assets/js/6.ebe2ab56.js"><link rel="prefetch" href="/Learning-notes/assets/js/7.0440d0cc.js"><link rel="prefetch" href="/Learning-notes/assets/js/8.2826deb1.js"><link rel="prefetch" href="/Learning-notes/assets/js/9.a90915b9.js">
    <link rel="stylesheet" href="/Learning-notes/assets/css/0.styles.20926f7d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Learning-notes/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Learning-notes/notes/" class="nav-link router-link-active">前端笔记</a></div><div class="nav-item"><a href="/Learning-notes/essays/" class="nav-link">个人随笔</a></div><div class="nav-item"><a href="https://github.com/LoneYin/Learning-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Learning-notes/notes/" class="nav-link router-link-active">前端笔记</a></div><div class="nav-item"><a href="/Learning-notes/essays/" class="nav-link">个人随笔</a></div><div class="nav-item"><a href="https://github.com/LoneYin/Learning-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Learning-notes/notes/browser/浏览器的进程与线程.html" class="sidebar-link">浏览器的进程与线程</a></li><li><a href="/Learning-notes/notes/browser/浏览器的渲染原理.html" class="sidebar-link">浏览器的渲染原理</a></li><li><a href="/Learning-notes/notes/browser/浏览器JS引擎.html" class="sidebar-link">浏览器JS引擎（V8）</a></li><li><a href="/Learning-notes/notes/browser/浏览器EventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/Learning-notes/notes/browser/浏览器缓存策略.html" class="sidebar-link">浏览器缓存策略</a></li><li><a href="/Learning-notes/notes/browser/跨域与页面通信.html" class="sidebar-link">跨域与页面通信</a></li><li><a href="/Learning-notes/notes/browser/浏览器DOM事件与事件监听.html" class="sidebar-link">浏览器 DOM 事件与事件监听</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网络知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Learning-notes/notes/network/TCP与DNS.html" class="sidebar-link">TCP协议与DNS协议</a></li><li><a href="/Learning-notes/notes/network/HTTP协议.html" class="sidebar-link">HTTP/HTTPS/HTTP2</a></li><li><a href="/Learning-notes/notes/network/GET和POST请求的区别.html" class="sidebar-link">GET请求和POST请求的区别</a></li><li><a href="/Learning-notes/notes/network/Web安全.html" class="sidebar-link">Web安全 —— XSS 与 CSRF</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Learning-notes/notes/advanced/JS执行上下文栈.html" class="sidebar-link">JS执行上下文栈</a></li><li><a href="/Learning-notes/notes/advanced/另一个角度理解this.html" class="sidebar-link">从另一个角度理解this的隐式绑定</a></li><li><a href="/Learning-notes/notes/advanced/闭包.html" class="sidebar-link">作用域与闭包</a></li><li><a href="/Learning-notes/notes/advanced/原型链与继承.html" class="sidebar-link">原型链与继承</a></li><li><a href="/Learning-notes/notes/advanced/new运算符.html" class="sidebar-link">new运算符到底做了什么</a></li><li><a href="/Learning-notes/notes/advanced/节流和防抖.html" class="sidebar-link">函数的节流和防抖</a></li><li><a href="/Learning-notes/notes/advanced/函数柯里化.html" class="sidebar-link">函数柯里化和偏函数</a></li><li><a href="/Learning-notes/notes/advanced/深拷贝.html" class="sidebar-link">实现一个深拷贝</a></li><li><a href="/Learning-notes/notes/advanced/bind和call和apply.html" class="sidebar-link">手写 bind/call/apply</a></li><li><a href="/Learning-notes/notes/advanced/Iterator和Generator.html" class="sidebar-link">Iterator 和 Generator</a></li><li><a href="/Learning-notes/notes/advanced/Promise.html" class="sidebar-link">Promise的链式调用原理</a></li><li><a href="/Learning-notes/notes/advanced/单例模式.html" class="sidebar-link">单例设计模式的应用</a></li><li><a href="/Learning-notes/notes/advanced/观察者模式.html" class="sidebar-link">观察者模式的简单实现</a></li><li><a href="/Learning-notes/notes/advanced/使用setTimeout模拟setInterval.html" class="sidebar-link">用 setTimeout 实现 setInterval</a></li><li><a href="/Learning-notes/notes/advanced/常见算法.html" class="sidebar-link">常见算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>其他知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Learning-notes/notes/others/模块加载机制.html" class="sidebar-link">模块加载机制</a></li><li><a href="/Learning-notes/notes/others/前端性能优化.html" class="sidebar-link">前端性能优化</a></li><li><a href="/Learning-notes/notes/others/面试题整理.html" class="sidebar-link">一些JS面试题整理</a></li><li><a href="/Learning-notes/notes/others/最后梳理一遍输入URL到页面渲染的流程.html" class="sidebar-link">最后梳理一遍从输入URL到页面渲染的流程</a></li><li><a href="/Learning-notes/notes/others/Webpack知识点整理.html" class="active sidebar-link">Webpack 知识点整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#webpack-核心概念" class="sidebar-link">Webpack 核心概念</a></li><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#webpack-的工作原理" class="sidebar-link">Webpack 的工作原理</a></li><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#webpack-模块化原理" class="sidebar-link">Webpack 模块化原理</a></li><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#webpack-的-hmr-原理" class="sidebar-link">Webpack 的 HMR 原理</a></li><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#webpack-优化" class="sidebar-link">Webpack 优化</a></li><li class="sidebar-sub-header"><a href="/Learning-notes/notes/others/Webpack知识点整理.html#output-中-chunk-的-hash-类型" class="sidebar-link">output 中 chunk 的 hash 类型</a></li></ul></li><li><a href="/Learning-notes/notes/others/Vue与React的区别.html" class="sidebar-link">Vue与React的区别</a></li><li><a href="/Learning-notes/notes/others/Vue源码阅读知识点整理.html" class="sidebar-link">Vue 源码阅读知识点整理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-知识点整理"><a href="#webpack-知识点整理" class="header-anchor">#</a> Webpack 知识点整理</h1> <h2 id="webpack-核心概念"><a href="#webpack-核心概念" class="header-anchor">#</a> Webpack 核心概念</h2> <ul><li>Module：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li> <li>Entry：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。</li> <li>Chunk：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</li> <li>Loader：模块转换器，用于把模块原内容按照需求转换成新内容。</li> <li>Plugin：扩展插件，在 Webpack 构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要的事情。</li> <li>Output：输出结果，在 Webpack 经过一系列处理并得出最终想要的代码后输出结果。</li></ul> <h2 id="webpack-的工作原理"><a href="#webpack-的工作原理" class="header-anchor">#</a> Webpack 的工作原理</h2> <p>Webpack 的运行流程是一个串行的过程，从启动到结束会依次执行以下流程：</p> <ol><li><p>初始化参数：从配置文件和 Shell 语句中读取与合并参数，得出最终的参数；</p></li> <li><p>开始编译：用上一步得到的参数初始化 Compiler 对象，加载所有配置的插件，执行对象的 run 方法开始执行编译；</p></li> <li><p>确定入口：根据配置中的 entry 找出所有的入口文件；</p></li> <li><p>编译模块：从入口文件出发，调用所有配置的 Loader 对模块进行翻译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理；</p></li> <li><p>完成模块编译：在经过第 4 步使用 Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系；</p></li> <li><p>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会；</p></li> <li><p>输出完成：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</p></li></ol> <p>在以上过程中，Webpack 会在特定的时间点广播出特定的事件，插件在监听到感兴趣的事件后会执行特定的逻辑，并且插件可以调用 Webpack 提供的 API 改变 Webpack 的运行结果。</p> <h2 id="webpack-模块化原理"><a href="#webpack-模块化原理" class="header-anchor">#</a> Webpack 模块化原理</h2> <p>首先 webpack 的 bundle.js 最外层是一个自执行函数</p> <p>如果有异步加载的模块，那么这个函数中还会额外定义一个 webpackJsonpCallback 方法和一个 requireEnsure（ <strong>webpack_require</strong>.e ）方法</p> <ul><li><strong>webpack_require</strong>.e 用于加载被分割出去的，需要异步加载的 Chunk 对应的文件</li> <li>webpackJsonp 用于从异步加载的文件中安装模块</li></ul> <p>在使用了 CommonsChunkPlugin 去提取公共代码时输出的文件和使用了异步加载时输出的文件是一样的，都会有__webpack_require__.e和webpackJsonp。 原因在于提取公共代码和异步加载本质上都是代码分割</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 模拟 require 语句</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 执行存放所有模块数组中的第0个模块</span>
  <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">/*存放所有模块的数组*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一个模块基本上就是入口文件 moduleId = 0</span>
    <span class="token comment">// 通过 __webpack_require__ 规范导入 show 函数，show.js 对应的模块 index 为 1</span>
    <span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行 show 函数</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token string">&quot;Webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello,'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 通过 CommonJS 规范导出 show 函数</span>
      module<span class="token punctuation">.</span>exports <span class="token operator">=</span> show<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>让我们来看一下 <strong>webpack_require</strong> 函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check if module is in cache</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token comment">// Create a new module (and put it into the cache)</span>
  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
    loaded<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Execute the module function</span>
  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
    module<span class="token punctuation">,</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
    __webpack_require__
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Flag the module as loaded</span>
  module<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">// Return the exports of the module</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际上就是模拟了 CommonJs 的 require module 和 exports，然后将 module exports require 作为参数传递给 modules 中的 module 使用</p> <h2 id="webpack-的-hmr-原理"><a href="#webpack-的-hmr-原理" class="header-anchor">#</a> Webpack 的 HMR 原理</h2> <ol><li><p>webpack 对文件系统进行 watch 并打包到内存中</p> <p>webpack-dev-middleware 调用 webpack 的 api 对文件系统 watch，当 hello.js 文件发生改变后，webpack 重新对文件进行编译打包，然后保存到内存中。</p></li> <li><p>devServer 通知浏览器端文件发生改变</p> <p>在这一阶段，sockjs 是服务端和浏览器端之间的桥梁，在启动 devServer 的时候，sockjs 在服务端和浏览器端建立了一个 webSocket 长连接，以便将 webpack 编译和打包的各个阶段状态告知浏览器，最关键的步骤还是 webpack-dev-server 调用 webpack 的 compiler 钩子监听 done 事件，当 compile 完成后，webpack-dev-server 通过 _sendStatus 方法将编译打包后的新模块 hash 值发送到浏览器端。</p></li> <li><p>webpack-dev-server/client 接收到服务端消息做出响应</p> <p>webpack-dev-server/client 当接收到 type 为 hash 消息后会将 hash 值暂存起来，当接收到 type 为 ok 的消息后对应用执行 reload 操作，如下图所示，hash 消息是在 ok 消息之前。</p> <p>在 reload 操作中，webpack-dev-server/client 会根据 hot 配置决定是刷新浏览器还是对代码进行热更新（HMR）</p> <p>首先将 hash 值暂存到 currentHash 变量，当接收到 ok 消息后，对 App 进行 reload。如果配置了模块热更新，就调用 webpack/hot/emitter 将最新 hash 值 通过 <code>hotEmitter.emit('webpackHotUpdate', currentHash)</code> 发送给 webpack/hot/dev-server（这个东西也在浏览器中）</p></li> <li><p>webpack/hot/dev-server 接收到最新 hash 值验证并通过 HMR runtime 请求模块代码</p> <p>webpack/hot/dev-server 监听第三步 webpack-dev-server/client 发送的 webpackHotUpdate 消息，调用 webpack/lib/HotModuleReplacement.runtime（简称 HMR runtime）中的 check 方法，检测是否有新的更新。如果有更新，则通过 JSONP 请求最新的模块代码，HMR runtime 会根据返回的新模块代码做进一步处理，可能是刷新页面，也可能是对模块进行热更新。</p></li> <li><p>HotModuleReplacement.runtime 对模块进行热更新</p> <p>这一步是整个模块热更新（HMR）的关键步骤，而且模块热更新都是发生在 HMR runtime 中的 hotApply 方法中</p> <p>模块热替换主要分三个阶段：</p> <ul><li>第一个阶段是找出 outdatedModules 和 outdatedDependencies</li> <li>第二个阶段从缓存中删除过期的模块和依赖</li> <li>第三个阶段是将新的模块添加到 modules 中，当下次调用 <strong>webpack_require</strong> 方法的时候，就是获取到了新的模块代码了</li></ul></li></ol> <h2 id="webpack-优化"><a href="#webpack-优化" class="header-anchor">#</a> Webpack 优化</h2> <ol><li><p>使用 HappyPack</p> <p>进行多进程 Loader 转换，它把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。</p></li> <li><p>使用 ParallelUglifyPlugin 并行压缩</p> <p>它会开启多个子进程，把对多个文件的压缩工作分配给多个子进程去完成，每个子进程其实还是通过 UglifyJS 去压缩代码，但是变成了并行执行。 所以 ParallelUglifyPlugin 能更快的完成对多个文件的压缩工作。</p></li> <li><p>开启 Tree Shaking （webpack-deep-scope-analysis-plugin）</p> <p>Tree Shaking原理：</p> <p>ES6的模块引入是静态分析的，故而可以在编译时正确判断到底加载了什么代码。分析程序流，判断哪些变量未被使用、引用，进而删除此代码。</p></li> <li><p>提取公共代码 CommonsChunkPlugin</p></li> <li><p>按需加载 调用 Webpack 的 import 方法</p></li> <li><p>开启 Scope Hoisting (作用于提升)</p> <p>Scope Hoisting 的实现原理其实很简单：分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。 因此只有那些被引用了一次的模块才能被合并。</p></li></ol> <h2 id="output-中-chunk-的-hash-类型"><a href="#output-中-chunk-的-hash-类型" class="header-anchor">#</a> output 中 chunk 的 hash 类型</h2> <ol><li><strong>hash</strong></li></ol> <blockquote><p>hash 是跟整个 webpack 构建项目相关的，每次项目构建hash对应的值都是不同的</p></blockquote> <p>同一次构建过程中生成的hash都是一样的，只要项目里有文件更改，整个项目构建的hash值都会更改。</p> <p>如果出口是 hash，那么一旦针对项目中任何一个文件的修改，都会构建整个项目，重新获取 hash 值，缓存的目的将失效</p> <ol><li><strong>chunkhash</strong></li></ol> <blockquote><p>根据入口 entry 配置文件来分析其依赖项并由此来构建该 entry 的 chunk ，并生成对应的 hash 值</p></blockquote> <p>它根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的 hash 值。我们在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用 chunkhash 的方式生成 hash 值，那么只要我们不改动公共库的代码，就可以保证其 hash 值不会受影响。</p> <p>由于采用 chunkhash，所以项目主入口文件 main.js 及其对应的依赖文件 main.css 由于被打包在同一个模块，所以共用相同的 chunkhash。</p> <p>这样就会有个问题，只要对应 css 或则 js 改变，与其关联的文件 hash 值也会改变，但其内容并没有改变，所以没有达到缓存意义。</p> <ol start="3"><li><strong>contenthash</strong></li></ol> <blockquote><p>contenthash 表示由文件内容产生的 hash 值，内容不同产生的 contenthash 值也不一样</p></blockquote> <p>contenthash表示由文件内容产生的hash值，内容不同产生的contenthash值也不一样。在项目中，通常做法是把项目中css都抽离出对应的css文件来加以引用。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Learning-notes/notes/others/最后梳理一遍输入URL到页面渲染的流程.html" class="prev">最后梳理一遍从输入URL到页面渲染的流程</a></span> <span class="next"><a href="/Learning-notes/notes/others/Vue与React的区别.html">Vue与React的区别</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Learning-notes/assets/js/app.d658b911.js" defer></script><script src="/Learning-notes/assets/js/2.ddf9653e.js" defer></script><script src="/Learning-notes/assets/js/40.f8dca0d5.js" defer></script>
  </body>
</html>
